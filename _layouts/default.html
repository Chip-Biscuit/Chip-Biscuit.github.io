<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  {% assign page_title = page.seo_title | default: page.title | default: site.social_title %}
  {% assign page_desc  = page.seo_description | default: page.description | default: site.social_desc %}
  {% assign page_image = page.og_image | default: site.social_image %}
  {% assign page_url   = page.url | absolute_url %}

  <title>{{ page_title | escape }}</title>
  <meta name="description" content="{{ page_desc | escape }}" />
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="/assets/css/site.css">

  <!-- Canonical -->
  <link rel="canonical" href="{{ page_url }}" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ page_url }}" />
  <meta property="og:site_name" content="Chip" />
  <meta property="og:title" content="{{ page_title }}" />
  <meta property="og:description" content="{{ page_desc }}" />
  <meta property="og:image" content="{{ page_image | absolute_url }}" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:type" content="image/png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ page_title }}" />
  <meta name="twitter:description" content="{{ page_desc }}" />
  <meta name="twitter:image" content="{{ page_image | absolute_url }}" />
</head>

<body>
  {% include header.html %}
  <main class="container prose">
    {{ content }}
  </main>

<script>
(function () {
  const key = "chip-theme";
  const btn = document.getElementById("theme-toggle");
  if (!btn) return;

  const sysPrefersDark = () => matchMedia("(prefers-color-scheme: dark)").matches;

  function setTheme(mode) {           // mode: "dark" | "light"
    document.documentElement.dataset.theme = mode;
    localStorage.setItem(key, mode);
    btn.textContent = mode === "light" ? "ðŸŒž" : "ðŸŒ™";
  }

  function effectiveTheme() {         // saved or system
    return localStorage.getItem(key) || (sysPrefersDark() ? "dark" : "light");
  }

  // Init
  setTheme(effectiveTheme());

  // One-click flip
  btn.addEventListener("click", () => {
    const next = effectiveTheme() === "dark" ? "light" : "dark";
    setTheme(next);
  });

  // If you ever remove the saved pref, keep in sync with system
  matchMedia("(prefers-color-scheme: dark)").addEventListener?.("change", () => {
    if (!localStorage.getItem(key)) setTheme(effectiveTheme());
  });
})();
</script>

</body>
</html>
