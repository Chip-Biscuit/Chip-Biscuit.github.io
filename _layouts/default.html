<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ page.title | escape }} â€¢ Chip Biscuit</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="stylesheet" href="/assets/css/site.css">
</head>
<body>
  {% include header.html %}
  <main class="container prose">
    {{ content }}
  </main>

<script>
(function () {
  const key = "chip-theme";
  const btn = document.getElementById("theme-toggle");
  if (!btn) return;

  const sysPrefersDark = () => matchMedia("(prefers-color-scheme: dark)").matches;

  function setTheme(mode) {           // mode: "dark" | "light"
    document.documentElement.dataset.theme = mode;
    localStorage.setItem(key, mode);
    btn.textContent = mode === "light" ? "ðŸŒž" : "ðŸŒ™";
  }

  function effectiveTheme() {         // saved or system
    return localStorage.getItem(key) || (sysPrefersDark() ? "dark" : "light");
  }

  // Init
  setTheme(effectiveTheme());

  // One-click flip
  btn.addEventListener("click", () => {
    const next = effectiveTheme() === "dark" ? "light" : "dark";
    setTheme(next);
  });

  // If you ever remove the saved pref, keep in sync with system
  matchMedia("(prefers-color-scheme: dark)").addEventListener?.("change", () => {
    if (!localStorage.getItem(key)) setTheme(effectiveTheme());
  });
})();
</script>

</body>
</html>
